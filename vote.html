<script type="application/javascript">
    const storyId = "STORY_ID_FROM_WEBFLOW_CMS";
    const getRoundMap = (idToken) => {
        const headers = new Headers();
        headers.append("Accept", "application/json");
        headers.append("Authorization", `Bearer ${idToken}`);

        const options = {
            headers: headers,
            method: "GET",
            cache: "default"
        }
        return fetch(`https://api.purplewallstories.com/round`, options)
    }
    const upVote = () => {
        return getIdToken().then((idToken) => {
            if (idToken) {
                const headers = new Headers();
                headers.append("Accept", "application/json");
                headers.append("Authorization", `Bearer ${idToken}`);

                const options = {
                    headers: headers,
                    method: "POST"
                }
                return fetch(`https://api.purplewallstories.com/vote/${storyId}`, options)
                    .then((response) => {
                        console.log(response.json());
                        preVote.style.display = "none";
                        postVote.style.display = "block";
                    })
            } else {
                window.location.replace("/auth/login");
            }
        }).catch((error) => {
            const errorCode = error.code;
            const errorMessage = error.message;
            console.log(`Error Code: ${errorCode} \n Error Msg: ${errorMessage}`);
        });
    };
    voteBtn.addEventListener("click", (event) => {
        event.preventDefault();
        upVote();
    });

    getIdToken()
        .then((idToken) => {
                if (idToken) getRoundMap(idToken)
                    .then((response) => {
                        response.json().then(body => {
                            const roundMap = body.data;
                            if (!(storyId in roundMap.stories)) {
                                voteColumn.style.display = "none";
                            }
                        });
                    });
            }
        ).catch((error) => {
        const errorCode = error.code;
        const errorMessage = error.message;
        console.log(`Error Code: ${errorCode} \n Error Msg: ${errorMessage}`);
    });
</script>