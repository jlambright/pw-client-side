<!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-app.js"></script>

<!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
<script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-analytics.js"></script>

<!-- Add Firebase products that you want to use -->
<script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-auth.js"></script>
<script type="application/javascript">
    const firebaseConfig = {
        apiKey: "AIzaSyDJKlhCcgnNPS-ZywZrwxvkxY9MkEGMVIo",
        authDomain: "purple-wall.firebaseapp.com",
        projectId: "purple-wall",
        storageBucket: "purple-wall.appspot.com",
        messagingSenderId: "734351381182",
        appId: "1:734351381182:web:522802128154b9283b84ef",
        measurementId: "G-ZRXWS6KWGN"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();

    const signOut = () => {
        return firebase.auth().signOut().then((response) => {
            console.log(response);
            return getIdToken()
                .finally(setTimeout(() => window.location.replace("/"), 150000))
                .catch((error) => {
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    console.log(`Error Code: ${errorCode}\nError Msg: ${errorMessage}`);
                });
        }).catch((error) => {
            const errorCode = error.code;
            const errorMessage = error.message;
            console.log(`Error Code: ${errorCode} \n Error Msg: ${errorMessage}`);
        });
    }

    window.signOut = signOut;

    signOutDrop.addEventListener("click", (event) => {
        event.preventDefault();
        signOut();
    });

    /**
     * Returns a promise that resolves with an ID token if available.
     * @return {!Promise<?string>} The promise that resolves with an ID token if
     *     available. Otherwise, the promise resolves with null.
     */
    const getIdToken = () => {
        return new Promise((resolve, reject) => {
            const unsubscribe = firebase.auth().onAuthStateChanged((user) => {
                unsubscribe();
                if (user) {
                    user.getIdToken().then((idToken) => {
                        postLogin.style.display = "block";
                        preLogin.style.display = "none";
                        resolve(idToken);
                    }, (error) => {
                        postLogin.style.display = "none";
                        preLogin.style.display = "block";
                        resolve(null);
                    });
                } else {
                    postLogin.style.display = "none";
                    preLogin.style.display = "block";
                    resolve(null);
                }
            });
        });
    };
    window.getIdToken = getIdToken;
    getIdToken();
</script>